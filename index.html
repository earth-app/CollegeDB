<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@earth-app/collegedb</title><meta name="description" content="Documentation for @earth-app/collegedb"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="index.html" class="title">@earth-app/collegedb</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>@earth-app/collegedb</h1></div><div class="tsd-panel tsd-typography"><h1 id="collegedb" class="tsd-anchor-link">CollegeDB<a href="#collegedb" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><blockquote>
<p>Cloudflare D1 Sharding Router</p>
</blockquote>
<p><a href="https://www.typescriptlang.org/"><img src="https://img.shields.io/badge/TypeScript-5.0+-blue.svg" alt="TypeScript"></a>
<a href="https://workers.cloudflare.com/"><img src="https://img.shields.io/badge/cloudflare-workers-orange.svg" alt="Cloudflare Workers"></a>
<a href="LICENSE"><img src="https://img.shields.io/badge/license-MIT-green.svg" alt="License"></a></p>
<p>A TypeScript library for horizontal scaling of SQLite-style databases on Cloudflare using D1 and KV. CollegeDB simulates vertical scaling by routing queries to the correct D1 database instance using primary key mappings stored in Cloudflare KV.</p>
<h2 id="overview" class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>CollegeDB provides a sharding layer on top of Cloudflare D1 databases, enabling you to:</p>
<ul>
<li><strong>Scale horizontally</strong> across multiple D1 instances</li>
<li><strong>Route queries automatically</strong> based on primary keys</li>
<li><strong>Maintain consistency</strong> with KV-based mapping</li>
<li><strong>Monitor and rebalance</strong> shard distribution</li>
<li><strong>Handle migrations</strong> between shards seamlessly</li>
</ul>
<h2 id="📦-features" class="tsd-anchor-link">📦 Features<a href="#📦-features" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><strong>🔀 Automatic Query Routing</strong>: Primary key → shard mapping using Cloudflare KV</li>
<li><strong>🎯 Multiple Allocation Strategies</strong>: Round-robin, random, or hash-based distribution</li>
<li><strong>📊 Shard Coordination</strong>: Durable Objects for allocation and statistics</li>
<li><strong>🛠 Migration Support</strong>: Move data between shards with zero downtime</li>
<li><strong>🔄 Automatic Drop-in Replacement</strong>: Zero-config integration with existing databases</li>
<li><strong>🤖 Smart Migration Detection</strong>: Automatically discovers and maps existing data</li>
<li><strong>⚡ High Performance</strong>: Optimized for Cloudflare Workers runtime</li>
<li><strong>🔧 TypeScript First</strong>: Full type safety and excellent DX</li>
</ul>
<h2 id="installation" class="tsd-anchor-link">Installation<a href="#installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="bash"><span class="hl-0">bun</span><span class="hl-1"> </span><span class="hl-2">add</span><span class="hl-1"> </span><span class="hl-2">collegedb</span><br/><span class="hl-3"># or</span><br/><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">collegedb</span>
</code><button type="button">Copy</button></pre>

<h2 id="basic-usage" class="tsd-anchor-link">Basic Usage<a href="#basic-usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">initialize</span><span class="hl-1">, </span><span class="hl-5">createSchema</span><span class="hl-1">, </span><span class="hl-5">run</span><span class="hl-1">, </span><span class="hl-5">first</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;collegedb&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">// Initialize with your Cloudflare bindings (existing databases work automatically!)</span><br/><span class="hl-0">initialize</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-5">kv:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-6">KV</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-5">coordinator:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-5">ShardCoordinator</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-5">shards:</span><span class="hl-1"> {</span><br/><span class="hl-1">		</span><span class="hl-2">&#39;db-east&#39;</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">[</span><span class="hl-2">&#39;db-east&#39;</span><span class="hl-1">], </span><span class="hl-3">// Can be existing DB with data</span><br/><span class="hl-1">		</span><span class="hl-2">&#39;db-west&#39;</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">[</span><span class="hl-2">&#39;db-west&#39;</span><span class="hl-1">] </span><span class="hl-3">// Can be existing DB with data</span><br/><span class="hl-1">	},</span><br/><span class="hl-1">	</span><span class="hl-5">strategy:</span><span class="hl-1"> </span><span class="hl-2">&#39;hash&#39;</span><span class="hl-1"> </span><span class="hl-3">// or &#39;round-robin&#39;, &#39;random&#39;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Create schema on new shards only (existing shards auto-detected)</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">createSchema</span><span class="hl-1">(</span><span class="hl-5">env</span><span class="hl-1">[</span><span class="hl-2">&#39;db-new-shard&#39;</span><span class="hl-1">]);</span><br/><br/><span class="hl-3">// Insert data (automatically routed to appropriate shard)</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&#39;user-123&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;INSERT INTO users (id, name, email) VALUES (?, ?, ?)&#39;</span><span class="hl-1">, [</span><span class="hl-2">&#39;user-123&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;Alice Johnson&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;alice@example.com&#39;</span><span class="hl-1">]);</span><br/><br/><span class="hl-3">// Query data (automatically routed to correct shard, works with existing data!)</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">first</span><span class="hl-1">&lt;</span><span class="hl-8">User</span><span class="hl-1">&gt;(</span><span class="hl-2">&#39;existing-user-456&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;SELECT * FROM users WHERE id = ?&#39;</span><span class="hl-1">, [</span><span class="hl-2">&#39;existing-user-456&#39;</span><span class="hl-1">]);</span><br/><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-5">result</span><span class="hl-1">); </span><span class="hl-3">// User data from existing database</span>
</code><button type="button">Copy</button></pre>

<h2 id="drop-in-replacement-for-existing-databases" class="tsd-anchor-link">Drop-in Replacement for Existing Databases<a href="#drop-in-replacement-for-existing-databases" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>CollegeDB supports <strong>seamless, automatic integration</strong> with existing D1 databases that already contain data. Simply add your existing databases as shards in the configuration. CollegeDB will automatically detect existing data and create the necessary shard mappings <strong>without requiring any manual migration steps</strong>.</p>
<h3 id="requirements-for-drop-in-replacement" class="tsd-anchor-link">Requirements for Drop-in Replacement<a href="#requirements-for-drop-in-replacement" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ol>
<li><strong>Primary Keys</strong>: All tables must have a primary key column (typically named <code>id</code>)</li>
<li><strong>Schema Compatibility</strong>: Tables should use standard SQLite data types</li>
<li><strong>Access Permissions</strong>: CollegeDB needs read/write access to existing databases</li>
<li><strong>KV Namespace</strong>: A Cloudflare KV namespace for storing shard mappings</li>
</ol>
<pre><code class="typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">initialize</span><span class="hl-1">, </span><span class="hl-5">first</span><span class="hl-1">, </span><span class="hl-5">run</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;collegedb&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">// Add your existing databases as shards - that&#39;s it!</span><br/><span class="hl-0">initialize</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-5">kv:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-6">KV</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-5">shards:</span><span class="hl-1"> {</span><br/><span class="hl-1">		</span><span class="hl-2">&#39;db-users&#39;</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-5">ExistingUserDB</span><span class="hl-1">, </span><span class="hl-3">// Your existing database with users</span><br/><span class="hl-1">		</span><span class="hl-2">&#39;db-orders&#39;</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-5">ExistingOrderDB</span><span class="hl-1">, </span><span class="hl-3">// Your existing database with orders</span><br/><span class="hl-1">		</span><span class="hl-2">&#39;db-new&#39;</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-5">NewDB</span><span class="hl-1"> </span><span class="hl-3">// Optional new shard for growth</span><br/><span class="hl-1">	},</span><br/><span class="hl-1">	</span><span class="hl-5">strategy:</span><span class="hl-1"> </span><span class="hl-2">&#39;hash&#39;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Existing data works immediately! 🎉</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">existingUser</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">first</span><span class="hl-1">(</span><span class="hl-2">&#39;user-from-old-db&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;SELECT * FROM users WHERE id = ?&#39;</span><span class="hl-1">, [</span><span class="hl-2">&#39;user-from-old-db&#39;</span><span class="hl-1">]);</span><br/><br/><span class="hl-3">// New data gets distributed automatically</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&#39;new-user-123&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;INSERT INTO users (id, name, email) VALUES (?, ?, ?)&#39;</span><span class="hl-1">, [</span><span class="hl-2">&#39;new-user-123&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;New User&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;new@example.com&#39;</span><span class="hl-1">]);</span>
</code><button type="button">Copy</button></pre>

<p><strong>That's it!</strong> No migration scripts, no manual mapping creation, no downtime. Your existing data is immediately accessible through CollegeDB's sharding system.</p>
<h3 id="manual-validation-optional" class="tsd-anchor-link">Manual Validation (Optional)<a href="#manual-validation-optional" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>You can manually validate databases before integration if needed:</p>
<pre><code class="typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">validateTableForSharding</span><span class="hl-1">, </span><span class="hl-5">listTables</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;collegedb&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">// Check database structure</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">tables</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">listTables</span><span class="hl-1">(</span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-5">ExistingDB</span><span class="hl-1">);</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Found tables:&#39;</span><span class="hl-1">, </span><span class="hl-5">tables</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Validate each table</span><br/><span class="hl-4">for</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">table</span><span class="hl-1"> </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-5">tables</span><span class="hl-1">) {</span><br/><span class="hl-1">	</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">validation</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">validateTableForSharding</span><span class="hl-1">(</span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-5">ExistingDB</span><span class="hl-1">, </span><span class="hl-5">table</span><span class="hl-1">);</span><br/><span class="hl-1">	</span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-5">validation</span><span class="hl-1">.</span><span class="hl-5">isValid</span><span class="hl-1">) {</span><br/><span class="hl-1">		</span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`✅ </span><span class="hl-7">${</span><span class="hl-5">table</span><span class="hl-7">}</span><span class="hl-2">: </span><span class="hl-7">${</span><span class="hl-5">validation</span><span class="hl-9">.</span><span class="hl-5">recordCount</span><span class="hl-7">}</span><span class="hl-2"> records ready`</span><span class="hl-1">);</span><br/><span class="hl-1">	} </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">		</span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`❌ </span><span class="hl-7">${</span><span class="hl-5">table</span><span class="hl-7">}</span><span class="hl-2">: </span><span class="hl-7">${</span><span class="hl-5">validation</span><span class="hl-9">.</span><span class="hl-5">issues</span><span class="hl-9">.</span><span class="hl-0">join</span><span class="hl-9">(</span><span class="hl-2">&#39;, &#39;</span><span class="hl-9">)</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">	}</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h3 id="manual-data-discovery-optional" class="tsd-anchor-link">Manual Data Discovery (Optional)<a href="#manual-data-discovery-optional" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>If you want to inspect existing data before automatic migration:</p>
<pre><code class="typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">discoverExistingPrimaryKeys</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;collegedb&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">// Discover all user IDs in existing users table</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">userIds</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">discoverExistingPrimaryKeys</span><span class="hl-1">(</span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-5">ExistingDB</span><span class="hl-1">, </span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">);</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Found </span><span class="hl-7">${</span><span class="hl-5">userIds</span><span class="hl-9">.</span><span class="hl-5">length</span><span class="hl-7">}</span><span class="hl-2"> existing users`</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Custom primary key column</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">orderIds</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">discoverExistingPrimaryKeys</span><span class="hl-1">(</span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-5">ExistingDB</span><span class="hl-1">, </span><span class="hl-2">&#39;orders&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;order_id&#39;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<h3 id="manual-integration-optional" class="tsd-anchor-link">Manual Integration (Optional)<a href="#manual-integration-optional" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>For complete control over the integration process:</p>
<pre><code class="typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">integrateExistingDatabase</span><span class="hl-1">, </span><span class="hl-5">KVShardMapper</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;collegedb&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">mapper</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">KVShardMapper</span><span class="hl-1">(</span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-6">KV</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Integrate your existing database</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">integrateExistingDatabase</span><span class="hl-1">(</span><br/><span class="hl-1">	</span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-5">ExistingDB</span><span class="hl-1">, </span><span class="hl-3">// Your existing D1 database</span><br/><span class="hl-1">	</span><span class="hl-2">&#39;db-primary&#39;</span><span class="hl-1">, </span><span class="hl-3">// Shard name for this database</span><br/><span class="hl-1">	</span><span class="hl-5">mapper</span><span class="hl-1">, </span><span class="hl-3">// KV mapper instance</span><br/><span class="hl-1">	{</span><br/><span class="hl-1">		</span><span class="hl-5">tables:</span><span class="hl-1"> [</span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;posts&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;orders&#39;</span><span class="hl-1">], </span><span class="hl-3">// Tables to integrate</span><br/><span class="hl-1">		</span><span class="hl-5">primaryKeyColumn:</span><span class="hl-1"> </span><span class="hl-2">&#39;id&#39;</span><span class="hl-1">, </span><span class="hl-3">// Primary key column name</span><br/><span class="hl-1">		</span><span class="hl-5">strategy:</span><span class="hl-1"> </span><span class="hl-2">&#39;hash&#39;</span><span class="hl-1">, </span><span class="hl-3">// Allocation strategy for future records</span><br/><span class="hl-1">		</span><span class="hl-5">addShardMappingsTable:</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1">, </span><span class="hl-3">// Add CollegeDB metadata table</span><br/><span class="hl-1">		</span><span class="hl-5">dryRun:</span><span class="hl-1"> </span><span class="hl-7">false</span><span class="hl-1"> </span><span class="hl-3">// Set true for testing</span><br/><span class="hl-1">	}</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-5">result</span><span class="hl-1">.</span><span class="hl-5">success</span><span class="hl-1">) {</span><br/><span class="hl-1">	</span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`✅ Integrated </span><span class="hl-7">${</span><span class="hl-5">result</span><span class="hl-9">.</span><span class="hl-5">totalRecords</span><span class="hl-7">}</span><span class="hl-2"> records from </span><span class="hl-7">${</span><span class="hl-5">result</span><span class="hl-9">.</span><span class="hl-5">tablesProcessed</span><span class="hl-7">}</span><span class="hl-2"> tables`</span><span class="hl-1">);</span><br/><span class="hl-1">} </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&#39;Integration issues:&#39;</span><span class="hl-1">, </span><span class="hl-5">result</span><span class="hl-1">.</span><span class="hl-5">issues</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>After integration, initialize CollegeDB with your existing databases as shards:</p>
<pre><code class="typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">initialize</span><span class="hl-1">, </span><span class="hl-5">first</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;collegedb&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">// Include existing databases as shards</span><br/><span class="hl-0">initialize</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-5">kv:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-6">KV</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-5">coordinator:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-5">ShardCoordinator</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-5">shards:</span><span class="hl-1"> {</span><br/><span class="hl-1">		</span><span class="hl-2">&#39;db-primary&#39;</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-5">ExistingDB</span><span class="hl-1">, </span><span class="hl-3">// Your integrated existing database</span><br/><span class="hl-1">		</span><span class="hl-2">&#39;db-secondary&#39;</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-5">AnotherExistingDB</span><span class="hl-1">, </span><span class="hl-3">// Another existing database</span><br/><span class="hl-1">		</span><span class="hl-2">&#39;db-new&#39;</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-5">NewDB</span><span class="hl-1"> </span><span class="hl-3">// Optional new shard for growth</span><br/><span class="hl-1">	},</span><br/><span class="hl-1">	</span><span class="hl-5">strategy:</span><span class="hl-1"> </span><span class="hl-2">&#39;hash&#39;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Existing data is now automatically routed!</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">first</span><span class="hl-1">(</span><span class="hl-2">&#39;existing-user-123&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;SELECT * FROM users WHERE id = ?&#39;</span><span class="hl-1">, [</span><span class="hl-2">&#39;existing-user-123&#39;</span><span class="hl-1">]);</span>
</code><button type="button">Copy</button></pre>

<h3 id="complete-drop-in-example" class="tsd-anchor-link">Complete Drop-in Example<a href="#complete-drop-in-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The simplest possible integration - just add your existing databases:</p>
<pre><code class="typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">initialize</span><span class="hl-1">, </span><span class="hl-5">first</span><span class="hl-1">, </span><span class="hl-5">run</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;collegedb&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">export</span><span class="hl-1"> </span><span class="hl-4">default</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-7">async</span><span class="hl-1"> </span><span class="hl-0">fetch</span><span class="hl-1">(</span><span class="hl-5">request</span><span class="hl-1">: </span><span class="hl-8">Request</span><span class="hl-1">, </span><span class="hl-5">env</span><span class="hl-1">: </span><span class="hl-8">Env</span><span class="hl-1">): </span><span class="hl-8">Promise</span><span class="hl-1">&lt;</span><span class="hl-8">Response</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">		</span><span class="hl-3">// Step 1: Initialize with existing databases (automatic migration happens here!)</span><br/><span class="hl-1">		</span><span class="hl-0">initialize</span><span class="hl-1">({</span><br/><span class="hl-1">			</span><span class="hl-5">kv:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-6">KV</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-5">shards:</span><span class="hl-1"> {</span><br/><span class="hl-1">				</span><span class="hl-2">&#39;db-users&#39;</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-5">ExistingUserDB</span><span class="hl-1">, </span><span class="hl-3">// Your existing database with users</span><br/><span class="hl-1">				</span><span class="hl-2">&#39;db-orders&#39;</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-5">ExistingOrderDB</span><span class="hl-1">, </span><span class="hl-3">// Your existing database with orders</span><br/><span class="hl-1">				</span><span class="hl-2">&#39;db-new&#39;</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-5">NewDB</span><span class="hl-1"> </span><span class="hl-3">// New shard for future growth</span><br/><span class="hl-1">			},</span><br/><span class="hl-1">			</span><span class="hl-5">strategy:</span><span class="hl-1"> </span><span class="hl-2">&#39;hash&#39;</span><br/><span class="hl-1">		});</span><br/><br/><span class="hl-1">		</span><span class="hl-3">// Step 2: Use existing data immediately - no migration needed!</span><br/><span class="hl-1">		</span><span class="hl-3">// Supports typed queries, inserts, updates, deletes, etc.</span><br/><span class="hl-1">		</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">existingUser</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">first</span><span class="hl-1">&lt;</span><span class="hl-8">User</span><span class="hl-1">&gt;(</span><span class="hl-2">&#39;user-from-old-db&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;SELECT * FROM users WHERE id = ?&#39;</span><span class="hl-1">, [</span><span class="hl-2">&#39;user-from-old-db&#39;</span><span class="hl-1">]);</span><br/><br/><span class="hl-1">		</span><span class="hl-3">// Step 3: New data gets distributed automatically</span><br/><span class="hl-1">		</span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&#39;new-user-123&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;INSERT INTO users (id, name, email) VALUES (?, ?, ?)&#39;</span><span class="hl-1">, [</span><span class="hl-2">&#39;new-user-123&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;New User&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;new@example.com&#39;</span><span class="hl-1">]);</span><br/><br/><span class="hl-1">		</span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">Response</span><span class="hl-1">(</span><br/><span class="hl-1">			</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">({</span><br/><span class="hl-1">				</span><span class="hl-5">existingUser:</span><span class="hl-1"> </span><span class="hl-5">existingUser</span><span class="hl-1">.</span><span class="hl-5">results</span><span class="hl-1">[</span><span class="hl-10">0</span><span class="hl-1">],</span><br/><span class="hl-1">				</span><span class="hl-5">message:</span><span class="hl-1"> </span><span class="hl-2">&#39;Automatic drop-in replacement successful!&#39;</span><br/><span class="hl-1">			})</span><br/><span class="hl-1">		);</span><br/><span class="hl-1">	}</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<h3 id="manual-integration-example" class="tsd-anchor-link">Manual Integration Example<a href="#manual-integration-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>If your tables use different primary key column names:</p>
<pre><code class="typescript"><span class="hl-3">// For tables with custom primary key columns</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">productIds</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">discoverExistingPrimaryKeys</span><span class="hl-1">(</span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-5">ProductDB</span><span class="hl-1">, </span><span class="hl-2">&#39;products&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;product_id&#39;</span><span class="hl-1">);</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">sessionIds</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">discoverExistingPrimaryKeys</span><span class="hl-1">(</span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-5">SessionDB</span><span class="hl-1">, </span><span class="hl-2">&#39;sessions&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;session_key&#39;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>Integrate only specific tables from existing databases:</p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">integrateExistingDatabase</span><span class="hl-1">(</span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-5">ExistingDB</span><span class="hl-1">, </span><span class="hl-2">&#39;db-legacy&#39;</span><span class="hl-1">, </span><span class="hl-5">mapper</span><span class="hl-1">, {</span><br/><span class="hl-1">	</span><span class="hl-5">tables:</span><span class="hl-1"> [</span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;orders&#39;</span><span class="hl-1">] </span><span class="hl-3">// Only integrate these tables</span><br/><span class="hl-1">	</span><span class="hl-3">// Skip &#39;temp_logs&#39;, &#39;cache_data&#39;, etc.</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Test integration without making changes:</p>
<pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">testResult</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">integrateExistingDatabase</span><span class="hl-1">(</span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-5">ExistingDB</span><span class="hl-1">, </span><span class="hl-2">&#39;db-test&#39;</span><span class="hl-1">, </span><span class="hl-5">mapper</span><span class="hl-1">, {</span><br/><span class="hl-1">	</span><span class="hl-5">dryRun:</span><span class="hl-1"> </span><span class="hl-7">true</span><span class="hl-1"> </span><span class="hl-3">// No actual mappings created</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Would process </span><span class="hl-7">${</span><span class="hl-5">testResult</span><span class="hl-9">.</span><span class="hl-5">totalRecords</span><span class="hl-7">}</span><span class="hl-2"> records from </span><span class="hl-7">${</span><span class="hl-5">testResult</span><span class="hl-9">.</span><span class="hl-5">tablesProcessed</span><span class="hl-7">}</span><span class="hl-2"> tables`</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<h3 id="performance-impact" class="tsd-anchor-link">Performance Impact<a href="#performance-impact" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><strong>One-time Setup</strong>: Migration detection runs once per shard</li>
<li><strong>Minimal Overhead</strong>: Only scans table metadata and sample records</li>
<li><strong>Cached Results</strong>: Subsequent operations have no migration overhead</li>
<li><strong>Async Processing</strong>: Doesn't block application startup or queries</li>
</ul>
<pre><code class="typescript"><span class="hl-3">// Simple rollback - clear all mappings</span><br/><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">KVShardMapper</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;collegedb&#39;</span><span class="hl-1">;</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">mapper</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">KVShardMapper</span><span class="hl-1">(</span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-6">KV</span><span class="hl-1">);</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">mapper</span><span class="hl-1">.</span><span class="hl-0">clearAllMappings</span><span class="hl-1">(); </span><span class="hl-3">// Returns to pre-migration state</span><br/><br/><span class="hl-3">// Or clear cache to force re-detection</span><br/><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">clearMigrationCache</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;collegedb&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">clearMigrationCache</span><span class="hl-1">(); </span><span class="hl-3">// Forces fresh migration check</span>
</code><button type="button">Copy</button></pre>

<h2 id="troubleshooting" class="tsd-anchor-link">Troubleshooting<a href="#troubleshooting" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p><strong>Tables without Primary Keys</strong></p>
<pre><code class="typescript"><span class="hl-3">// Error: Primary key column &#39;id&#39; not found</span><br/><span class="hl-3">// Solution: Add primary key to existing table</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">db</span><span class="hl-1">.</span><span class="hl-0">prepare</span><span class="hl-1">(</span><span class="hl-2">`ALTER TABLE legacy_table ADD COLUMN id TEXT PRIMARY KEY`</span><span class="hl-1">).</span><span class="hl-0">run</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p><strong>Large Database Integration</strong></p>
<pre><code class="typescript"><span class="hl-3">// For very large databases, integrate in batches</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">allTables</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">listTables</span><span class="hl-1">(</span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-5">LargeDB</span><span class="hl-1">);</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">batchSize</span><span class="hl-1"> = </span><span class="hl-10">2</span><span class="hl-1">;</span><br/><br/><span class="hl-4">for</span><span class="hl-1"> (</span><span class="hl-7">let</span><span class="hl-1"> </span><span class="hl-5">i</span><span class="hl-1"> = </span><span class="hl-10">0</span><span class="hl-1">; </span><span class="hl-5">i</span><span class="hl-1"> &lt; </span><span class="hl-5">allTables</span><span class="hl-1">.</span><span class="hl-5">length</span><span class="hl-1">; </span><span class="hl-5">i</span><span class="hl-1"> += </span><span class="hl-5">batchSize</span><span class="hl-1">) {</span><br/><span class="hl-1">	</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">batch</span><span class="hl-1"> = </span><span class="hl-5">allTables</span><span class="hl-1">.</span><span class="hl-0">slice</span><span class="hl-1">(</span><span class="hl-5">i</span><span class="hl-1">, </span><span class="hl-5">i</span><span class="hl-1"> + </span><span class="hl-5">batchSize</span><span class="hl-1">);</span><br/><span class="hl-1">	</span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">integrateExistingDatabase</span><span class="hl-1">(</span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-5">LargeDB</span><span class="hl-1">, </span><span class="hl-2">&#39;db-large&#39;</span><span class="hl-1">, </span><span class="hl-5">mapper</span><span class="hl-1">, {</span><br/><span class="hl-1">		</span><span class="hl-5">tables:</span><span class="hl-1"> </span><span class="hl-5">batch</span><br/><span class="hl-1">	});</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Mixed Primary Key Types</strong></p>
<pre><code class="typescript"><span class="hl-3">// Handle different primary key column names per table</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">customIntegration</span><span class="hl-1"> = {</span><br/><span class="hl-1">	</span><span class="hl-5">users:</span><span class="hl-1"> </span><span class="hl-2">&#39;user_id&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-5">orders:</span><span class="hl-1"> </span><span class="hl-2">&#39;order_number&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-5">products:</span><span class="hl-1"> </span><span class="hl-2">&#39;sku&#39;</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-4">for</span><span class="hl-1"> (</span><span class="hl-7">const</span><span class="hl-1"> [</span><span class="hl-6">table</span><span class="hl-1">, </span><span class="hl-6">pkColumn</span><span class="hl-1">] </span><span class="hl-7">of</span><span class="hl-1"> </span><span class="hl-5">Object</span><span class="hl-1">.</span><span class="hl-0">entries</span><span class="hl-1">(</span><span class="hl-5">customIntegration</span><span class="hl-1">)) {</span><br/><span class="hl-1">	</span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">keys</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">discoverExistingPrimaryKeys</span><span class="hl-1">(</span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-6">DB</span><span class="hl-1">, </span><span class="hl-5">table</span><span class="hl-1">, </span><span class="hl-5">pkColumn</span><span class="hl-1">);</span><br/><span class="hl-1">	</span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">createMappingsForExistingKeys</span><span class="hl-1">(</span><span class="hl-5">keys</span><span class="hl-1">, [</span><span class="hl-2">&#39;db-shard1&#39;</span><span class="hl-1">], </span><span class="hl-2">&#39;hash&#39;</span><span class="hl-1">, </span><span class="hl-5">mapper</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h2 id="📚-api-reference" class="tsd-anchor-link">📚 API Reference<a href="#📚-api-reference" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
<th>Parameters</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>initialize(config)</code></td>
<td>Initialize CollegeDB with configuration</td>
<td><code>CollegeDBConfig</code></td>
</tr>
<tr>
<td><code>createSchema(d1)</code></td>
<td>Create database schema on a D1 instance</td>
<td><code>D1Database</code></td>
</tr>
<tr>
<td><code>prepare(key, sql)</code></td>
<td>Prepare a SQL statement for execution</td>
<td><code>string, string</code></td>
</tr>
<tr>
<td><code>run(key, sql, bindings)</code></td>
<td>Execute a SQL query with primary key routing</td>
<td><code>string, string, any[]</code></td>
</tr>
<tr>
<td><code>first(key, sql, bindings)</code></td>
<td>Execute a SQL query and return first result</td>
<td><code>string, string, any[]</code></td>
</tr>
<tr>
<td><code>all(key, sql, bindings)</code></td>
<td>Execute a SQL query and return all results</td>
<td><code>string, string, any[]</code></td>
</tr>
<tr>
<td><code>reassignShard(key, newShard)</code></td>
<td>Move primary key to different shard</td>
<td><code>string, string</code></td>
</tr>
<tr>
<td><code>listKnownShards()</code></td>
<td>Get list of available shards</td>
<td><code>void</code></td>
</tr>
<tr>
<td><code>getShardStats()</code></td>
<td>Get statistics for all shards</td>
<td><code>void</code></td>
</tr>
</tbody>
</table>
<h3 id="drop-in-replacement-functions" class="tsd-anchor-link">Drop-in Replacement Functions<a href="#drop-in-replacement-functions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
<th>Parameters</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>autoDetectAndMigrate(d1, shard, config)</code></td>
<td><strong>NEW</strong>: Automatically detect and migrate existing data</td>
<td><code>D1Database, string, config</code></td>
</tr>
<tr>
<td><code>checkMigrationNeeded(d1, shard, config)</code></td>
<td><strong>NEW</strong>: Check if database needs migration</td>
<td><code>D1Database, string, config</code></td>
</tr>
<tr>
<td><code>validateTableForSharding(d1, table)</code></td>
<td>Check if table is suitable for sharding</td>
<td><code>D1Database, string</code></td>
</tr>
<tr>
<td><code>discoverExistingPrimaryKeys(d1, table)</code></td>
<td>Find all primary keys in existing table</td>
<td><code>D1Database, string</code></td>
</tr>
<tr>
<td><code>integrateExistingDatabase(d1, shard)</code></td>
<td>Complete drop-in integration of existing DB</td>
<td><code>D1Database, string, mapper</code></td>
</tr>
<tr>
<td><code>createMappingsForExistingKeys(keys)</code></td>
<td>Create shard mappings for existing keys</td>
<td><code>string[], string[], strategy</code></td>
</tr>
<tr>
<td><code>listTables(d1)</code></td>
<td>Get list of tables in database</td>
<td><code>D1Database</code></td>
</tr>
<tr>
<td><code>clearMigrationCache()</code></td>
<td><strong>NEW</strong>: Clear automatic migration cache</td>
<td><code>void</code></td>
</tr>
</tbody>
</table>
<h2 id="🏗-architecture" class="tsd-anchor-link">🏗 Architecture<a href="#🏗-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code><span class="hl-1">┌─────────────────────────────────────────────────────────────┐</span><br/><span class="hl-1">│                    </span><span class="hl-5">Cloudflare</span><span class="hl-1"> </span><span class="hl-5">Worker</span><span class="hl-1">                        │</span><br/><span class="hl-1">├─────────────────────────────────────────────────────────────┤</span><br/><span class="hl-1">│                     </span><span class="hl-5">CollegeDB</span><span class="hl-1"> </span><span class="hl-5">Router</span><span class="hl-1">                        │</span><br/><span class="hl-1">│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │</span><br/><span class="hl-1">│  │     </span><span class="hl-6">KV</span><span class="hl-1">      │  │  </span><span class="hl-5">Durable</span><span class="hl-1">    │  │   </span><span class="hl-5">Query</span><span class="hl-1"> </span><span class="hl-5">Router</span><span class="hl-1">      │  │</span><br/><span class="hl-1">│  │  </span><span class="hl-5">Mappings</span><span class="hl-1">   │  │  </span><span class="hl-5">Objects</span><span class="hl-1">    │  │                     │  │</span><br/><span class="hl-1">│  │             │  │ (</span><span class="hl-5">Optional</span><span class="hl-1">)  │  │                     │  │</span><br/><span class="hl-1">│  └─────────────┘  └─────────────┘  └─────────────────────┘  │</span><br/><span class="hl-1">├─────────────────────────────────────────────────────────────┤</span><br/><span class="hl-1">│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │</span><br/><span class="hl-1">│  │   </span><span class="hl-6">D1</span><span class="hl-1"> </span><span class="hl-5">East</span><span class="hl-1">   │  │  </span><span class="hl-6">D1</span><span class="hl-1"> </span><span class="hl-5">West</span><span class="hl-1">    │  │    </span><span class="hl-6">D1</span><span class="hl-1"> </span><span class="hl-5">Central</span><span class="hl-1">       │  │</span><br/><span class="hl-1">│  │   </span><span class="hl-5">Shard</span><span class="hl-1">     │  │   </span><span class="hl-5">Shard</span><span class="hl-1">     │  │     </span><span class="hl-5">Shard</span><span class="hl-1">           │  │</span><br/><span class="hl-1">│  │             │  │             │  │   (</span><span class="hl-5">Optional</span><span class="hl-1">)        │  │</span><br/><span class="hl-1">│  └─────────────┘  └─────────────┘  └─────────────────────┘  │</span><br/><span class="hl-1">└─────────────────────────────────────────────────────────────┘</span>
</code><button>Copy</button></pre>

<h3 id="data-flow" class="tsd-anchor-link">Data Flow<a href="#data-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ol>
<li><strong>Query Received</strong>: Application sends query with primary key</li>
<li><strong>Shard Resolution</strong>: CollegeDB checks KV for existing mapping or allocates new shard</li>
<li><strong>Query Execution</strong>: SQL executed on appropriate D1 database</li>
<li><strong>Response</strong>: Results returned to application</li>
</ol>
<h3 id="shard-allocation-strategies" class="tsd-anchor-link">Shard Allocation Strategies<a href="#shard-allocation-strategies" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><strong>Hash</strong>: Consistent hashing for deterministic shard selection</li>
<li><strong>Round-Robin</strong>: Evenly distribute new keys across shards</li>
<li><strong>Random</strong>: Random shard selection for load balancing</li>
</ul>
<h2 id="🌐-cloudflare-setup" class="tsd-anchor-link">🌐 Cloudflare Setup<a href="#🌐-cloudflare-setup" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="1-create-d1-databases" class="tsd-anchor-link">1. Create D1 Databases<a href="#1-create-d1-databases" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="bash"><span class="hl-3"># Create multiple D1 databases for sharding</span><br/><span class="hl-0">wrangler</span><span class="hl-1"> </span><span class="hl-2">d1</span><span class="hl-1"> </span><span class="hl-2">create</span><span class="hl-1"> </span><span class="hl-2">collegedb-east</span><br/><span class="hl-0">wrangler</span><span class="hl-1"> </span><span class="hl-2">d1</span><span class="hl-1"> </span><span class="hl-2">create</span><span class="hl-1"> </span><span class="hl-2">collegedb-west</span><br/><span class="hl-0">wrangler</span><span class="hl-1"> </span><span class="hl-2">d1</span><span class="hl-1"> </span><span class="hl-2">create</span><span class="hl-1"> </span><span class="hl-2">collegedb-central</span>
</code><button type="button">Copy</button></pre>

<h3 id="2-create-kv-namespace" class="tsd-anchor-link">2. Create KV Namespace<a href="#2-create-kv-namespace" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="bash"><span class="hl-3"># Create KV namespace for shard mappings</span><br/><span class="hl-0">wrangler</span><span class="hl-1"> </span><span class="hl-2">kv</span><span class="hl-1"> </span><span class="hl-2">namespace</span><span class="hl-1"> </span><span class="hl-2">create</span><span class="hl-1"> </span><span class="hl-2">&quot;KV&quot;</span>
</code><button type="button">Copy</button></pre>

<h3 id="3-configure-wranglertoml" class="tsd-anchor-link">3. Configure wrangler.toml<a href="#3-configure-wranglertoml" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="toml">[[d1_databases]]
binding = "db-east"
database_name = "collegedb-east"
database_id = "your-database-id"

[[d1_databases]]
binding = "db-west"
database_name = "collegedb-west"
database_id = "your-database-id"

[[kv_namespaces]]
binding = "KV"
id = "your-kv-namespace-id"

[[durable_objects.bindings]]
name = "ShardCoordinator"
class_name = "ShardCoordinator"
</code><button type="button">Copy</button></pre>

<h3 id="4-deploy" class="tsd-anchor-link">4. Deploy<a href="#4-deploy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="bash"><span class="hl-3"># Deploy to Cloudflare Workers</span><br/><span class="hl-0">wrangler</span><span class="hl-1"> </span><span class="hl-2">deploy</span><br/><br/><span class="hl-3"># Deploy with environment</span><br/><span class="hl-0">wrangler</span><span class="hl-1"> </span><span class="hl-2">deploy</span><span class="hl-1"> </span><span class="hl-7">--env</span><span class="hl-1"> </span><span class="hl-2">production</span>
</code><button type="button">Copy</button></pre>

<h2 id="📊-monitoring-and-maintenance" class="tsd-anchor-link">📊 Monitoring and Maintenance<a href="#📊-monitoring-and-maintenance" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="shard-statistics" class="tsd-anchor-link">Shard Statistics<a href="#shard-statistics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">getShardStats</span><span class="hl-1">, </span><span class="hl-5">listKnownShards</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;collegedb&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">// Get detailed statistics</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">stats</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">getShardStats</span><span class="hl-1">();</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-5">stats</span><span class="hl-1">);</span><br/><span class="hl-3">// [</span><br/><span class="hl-3">//   { binding: &#39;db-east&#39;, count: 1542 },</span><br/><span class="hl-3">//   { binding: &#39;db-west&#39;, count: 1458 }</span><br/><span class="hl-3">// ]</span><br/><br/><span class="hl-3">// List available shards</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">shards</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">listKnownShards</span><span class="hl-1">();</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-5">shards</span><span class="hl-1">); </span><span class="hl-3">// [&#39;db-east&#39;, &#39;db-west&#39;]</span>
</code><button type="button">Copy</button></pre>

<h3 id="shard-rebalancing" class="tsd-anchor-link">Shard Rebalancing<a href="#shard-rebalancing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">reassignShard</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;collegedb&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">// Move a primary key to a different shard</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">reassignShard</span><span class="hl-1">(</span><span class="hl-2">&#39;user-123&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;db-west&#39;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<h3 id="health-monitoring" class="tsd-anchor-link">Health Monitoring<a href="#health-monitoring" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Monitor your CollegeDB deployment by tracking:</p>
<ul>
<li><strong>Shard distribution balance</strong></li>
<li><strong>Query latency per shard</strong></li>
<li><strong>Error rates and failed queries</strong></li>
<li><strong>KV operation metrics</strong></li>
</ul>
<h2 id="🔧-advanced-configuration" class="tsd-anchor-link">🔧 Advanced Configuration<a href="#🔧-advanced-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="custom-allocation-strategy" class="tsd-anchor-link">Custom Allocation Strategy<a href="#custom-allocation-strategy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-0">initialize</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-5">kv:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-6">KV</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-5">shards:</span><span class="hl-1"> { </span><span class="hl-2">&#39;db-east&#39;</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">[</span><span class="hl-2">&#39;db-east&#39;</span><span class="hl-1">], </span><span class="hl-2">&#39;db-west&#39;</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">[</span><span class="hl-2">&#39;db-west&#39;</span><span class="hl-1">] },</span><br/><span class="hl-1">	</span><span class="hl-5">strategy:</span><span class="hl-1"> </span><span class="hl-2">&#39;hash&#39;</span><span class="hl-1"> </span><span class="hl-3">// Shard selection based on primary key hash</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<h3 id="environment-specific-setup" class="tsd-anchor-link">Environment-Specific Setup<a href="#environment-specific-setup" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">config</span><span class="hl-1"> = {</span><br/><span class="hl-1">	</span><span class="hl-5">kv:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-6">KV</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-5">shards:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-6">NODE_ENV</span><span class="hl-1"> === </span><span class="hl-2">&#39;production&#39;</span><span class="hl-1"> ? { </span><span class="hl-2">&#39;db-prod-1&#39;</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">[</span><span class="hl-2">&#39;db-prod-1&#39;</span><span class="hl-1">], </span><span class="hl-2">&#39;db-prod-2&#39;</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">[</span><span class="hl-2">&#39;db-prod-2&#39;</span><span class="hl-1">] } : { </span><span class="hl-2">&#39;db-dev&#39;</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-5">env</span><span class="hl-1">[</span><span class="hl-2">&#39;db-dev&#39;</span><span class="hl-1">] },</span><br/><span class="hl-1">	</span><span class="hl-5">strategy:</span><span class="hl-1"> </span><span class="hl-2">&#39;round-robin&#39;</span><span class="hl-1"> </span><span class="hl-3">// Shard selection is evenly distributed, regardless of size</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-0">initialize</span><span class="hl-1">(</span><span class="hl-5">config</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<h2 id="🤝-contributing" class="tsd-anchor-link">🤝 Contributing<a href="#🤝-contributing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ol>
<li>Fork the repository</li>
<li>Create a feature branch: <code>git checkout -b feature/amazing-feature</code></li>
<li>Commit changes: <code>git commit -m 'Add amazing feature'</code></li>
<li>Push to branch: <code>git push origin feature/amazing-feature</code></li>
<li>Submit a pull request</li>
</ol>
<h2 id="📝-license" class="tsd-anchor-link">📝 License<a href="#📝-license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This project is licensed under the MIT License - see the <a href="media/LICENSE">LICENSE</a> file for details.</p>
<h2 id="🔗-links" class="tsd-anchor-link">🔗 Links<a href="#🔗-links" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><a href="https://developers.cloudflare.com/d1/">Cloudflare D1 Documentation</a></li>
<li><a href="https://developers.cloudflare.com/kv/">Cloudflare KV Documentation</a></li>
<li><a href="https://developers.cloudflare.com/workers/">Cloudflare Workers Documentation</a></li>
<li><a href="https://developers.cloudflare.com/durable-objects/">Durable Objects Documentation</a></li>
</ul>
<h2 id="🆘-support" class="tsd-anchor-link">🆘 Support<a href="#🆘-support" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li>📖 <a href="https://earth-app.github.io/CollegeDB">Documentation</a></li>
<li>🐛 <a href="https://github.com/earth-app/CollegeDB/issues">Report Issues</a></li>
<li>💬 <a href="https://github.com/earth-app/CollegeDB/discussions">Discussions</a></li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#collegedb"><span>College<wbr/>DB</span></a><ul><li><a href="#overview"><span>Overview</span></a></li><li><a href="#📦-features"><span>📦 <wbr/>Features</span></a></li><li><a href="#installation"><span>Installation</span></a></li><li><a href="#basic-usage"><span>Basic <wbr/>Usage</span></a></li><li><a href="#drop-in-replacement-for-existing-databases"><span>Drop-<wbr/>in <wbr/>Replacement for <wbr/>Existing <wbr/>Databases</span></a></li><li><ul><li><a href="#requirements-for-drop-in-replacement"><span>Requirements for <wbr/>Drop-<wbr/>in <wbr/>Replacement</span></a></li><li><a href="#manual-validation-optional"><span>Manual <wbr/>Validation (<wbr/>Optional)</span></a></li><li><a href="#manual-data-discovery-optional"><span>Manual <wbr/>Data <wbr/>Discovery (<wbr/>Optional)</span></a></li><li><a href="#manual-integration-optional"><span>Manual <wbr/>Integration (<wbr/>Optional)</span></a></li><li><a href="#complete-drop-in-example"><span>Complete <wbr/>Drop-<wbr/>in <wbr/>Example</span></a></li><li><a href="#manual-integration-example"><span>Manual <wbr/>Integration <wbr/>Example</span></a></li><li><a href="#performance-impact"><span>Performance <wbr/>Impact</span></a></li></ul></li><li><a href="#troubleshooting"><span>Troubleshooting</span></a></li><li><a href="#📚-api-reference"><span>📚 <wbr/>API <wbr/>Reference</span></a></li><li><ul><li><a href="#drop-in-replacement-functions"><span>Drop-<wbr/>in <wbr/>Replacement <wbr/>Functions</span></a></li></ul></li><li><a href="#🏗-architecture"><span>🏗 <wbr/>Architecture</span></a></li><li><ul><li><a href="#data-flow"><span>Data <wbr/>Flow</span></a></li><li><a href="#shard-allocation-strategies"><span>Shard <wbr/>Allocation <wbr/>Strategies</span></a></li></ul></li><li><a href="#🌐-cloudflare-setup"><span>🌐 <wbr/>Cloudflare <wbr/>Setup</span></a></li><li><ul><li><a href="#1-create-d1-databases"><span>1. <wbr/>Create <wbr/>D1 <wbr/>Databases</span></a></li><li><a href="#2-create-kv-namespace"><span>2. <wbr/>Create <wbr/>KV <wbr/>Namespace</span></a></li><li><a href="#3-configure-wranglertoml"><span>3. <wbr/>Configure wrangler.toml</span></a></li><li><a href="#4-deploy"><span>4. <wbr/>Deploy</span></a></li></ul></li><li><a href="#📊-monitoring-and-maintenance"><span>📊 <wbr/>Monitoring and <wbr/>Maintenance</span></a></li><li><ul><li><a href="#shard-statistics"><span>Shard <wbr/>Statistics</span></a></li><li><a href="#shard-rebalancing"><span>Shard <wbr/>Rebalancing</span></a></li><li><a href="#health-monitoring"><span>Health <wbr/>Monitoring</span></a></li></ul></li><li><a href="#🔧-advanced-configuration"><span>🔧 <wbr/>Advanced <wbr/>Configuration</span></a></li><li><ul><li><a href="#custom-allocation-strategy"><span>Custom <wbr/>Allocation <wbr/>Strategy</span></a></li><li><a href="#environment-specific-setup"><span>Environment-<wbr/>Specific <wbr/>Setup</span></a></li></ul></li><li><a href="#🤝-contributing"><span>🤝 <wbr/>Contributing</span></a></li><li><a href="#📝-license"><span>📝 <wbr/>License</span></a></li><li><a href="#🔗-links"><span>🔗 <wbr/>Links</span></a></li><li><a href="#🆘-support"><span>🆘 <wbr/>Support</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">@earth-app/collegedb</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
